(()=>{const n=(e,t,n)=>{n={bubbles:!0,detail:{},...n},e.dispatchEvent(new CustomEvent(t,n))},a=(e,t,n)=>{/^{.*}$/s.test(e)&&(e=e.slice(1,-1));try{return new Function("__data",`with(__data) {return {${e}}}`).call(n,t)}catch(t){return console.error("[Nomini] failed to parse obj:",e,`
`,t),{}}},o=(e,t)=>{const n=e.matches(t)?[e]:[];return[...n,...e.querySelectorAll(t)].filter(e=>!e.closest("[nm-ignore]"))},r=e=>e.closest("[nm-data]")?.nmProxy||{...c},i=t=>{e=t,e(),e=null};let e=null,t=null;const c={$refs:{},_nmFetching:!1,_nmAbort:null,$get(e,t){this.$fetch(e,"GET",t)},$post(e,t){this.$fetch(e,"POST",t)},$fetch(e,s,o){const r=t;this._nmAbort&&this._nmAbort.abort(),this._nmAbort=new AbortController,this._nmFetching=!0;const i={headers:{"nm-request":!0},method:s,signal:this._nmAbort.signal};o={...this.$nmData(),...this.$dataset(),...o};const a=new URLSearchParams(o);/GET|DELETE/.test(s)?e+=(e.includes("?")?"&":"?")+a:i.body=a,fetch(e,i).then(async e=>{if(!e.ok){const t=await e.text();throw new Error(`${e.statusText}: ${t}`)}const t=new TextDecoder;for await(const n of e.body){const s=t.decode(n,{stream:!0});l(s)}}).catch(t=>n(r,"fetcherr",{detail:{err:t,url:e}})).finally(()=>this._nmFetching=!1)},$nmData(){const e=e=>/string|number|boolean/.test(typeof e);return Object.entries(this).reduce((t,[n,s])=>/^[a-z]+$/i.test(n)?(typeof s=="function"&&(s=s()),(e(s)||Array.isArray(s)&&s.every(e))&&(t[n]=s),t):t,{})},$dataset(){let n={},e=t;for(;e;){if(n={...n,...e.dataset},e.hasAttribute("nm-data"))break;e=e.parentElement}return n},$watch:i,$dispatch(e,s,o){n(t,e,{detail:s,...o})},$persist(e,t){t=t||`_nmProp-${e}`;const n=localStorage[t];n&&(this[e]=JSON.parse(n)),i(()=>{localStorage[t]=JSON.stringify(this[e])})}},l=e=>{const t=document.createElement("template");t.innerHTML=e;for(const e of t.content.children){if(!e.id){console.warn("[Nomini] Fragment is missing an id: ",e);continue}const i=e.getAttribute("nm-swap")||"outer",o=document.getElementById(e.id);if(!o){console.warn("[Nomini] Swap target not found: #",e.id);continue}if(n(o,"destroy"),i==="inner")o.replaceChildren(...e.childNodes),s(o);else if(i==="outer")o.replaceWith(e),s(e);else if(/(before|after|prepend|append)/.test(i)){const t=[...e.childNodes];o[i](...t),t.forEach(e=>e.nodeType===1&&s(e))}else console.error("[Nomini] Invalid swap strategy: ",i)}},s=s=>{o(s,"[nm-data]").forEach(t=>{const s={...a(t.getAttribute("nm-data"),{},t),...c},n=Object.keys(s).reduce((e,t)=>(e[t]=new Set,e),{}),o=new Proxy(s,{get(t,s){return s in n&&e&&n[s].add(e),t[s]},set(t,s,o){t[s]=o,s in n||(n[s]=new Set);const i=e;return e=null,n[s].forEach(e=>e()),e=i,!0}});t.nmProxy=o}),o(s,"[nm-ref]").forEach(e=>{const t=r(e),n=e.getAttribute("nm-ref");t.$refs[n]=e}),o(s,"[nm-bind]").forEach(e=>{const s=r(e),o=a(e.getAttribute("nm-bind"),s,e);Object.entries(o).forEach(([n,s])=>{if(n.startsWith("on")){const[a,...o]=n.slice(2).split("."),r=o.find(e=>e.startsWith("debounce")),i=+r?.slice(8),c=n=>{const a=()=>{t=e,s(n),t=null};o.includes("prevent")&&n.preventDefault(),o.includes("stop")&&n.stopPropagation(),i?(clearTimeout(e.nmTimer),e.nmTimer=setTimeout(a,i)):a()};(o.includes("window")?window:e).addEventListener(a,c,{once:o.includes("once")})}else{t=e;const[o,a]=n.split(".");i(async()=>{const t=await s();a?o==="class"?e.classList.toggle(a,t):e[o][a]=t:e[o]=t}),t=null}}),n(e,"init",{bubbles:!1})})};document.addEventListener("DOMContentLoaded",()=>s(document.body))})()