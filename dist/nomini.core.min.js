(()=>{const o=(e,t,n)=>{n={bubbles:!0,detail:{},...n},e.dispatchEvent(new CustomEvent(t,n))},i=(e,t,n)=>{/^{.*}$/s.test(e)&&(e=e.slice(1,-1));try{return new Function("__data",`with(__data) {return {${e}}}`).call(n,t)}catch(t){return console.error("[Nomini] failed to parse obj:",e,`
`,t),{}}},n=(e,t)=>{const n=e.matches(t)?[e]:[];return[...n,...e.querySelectorAll(t)].filter(e=>!e.closest("[nm-ignore]"))},a=e=>e.closest("[nm-data]")?.nmProxy||{...r},s=t=>{e=t,e(),e=null};let e=null,t=null;const r={$refs:{},$dataset(){let n={},e=t;for(;e;){if(n={...n,...e.dataset},e.hasAttribute("nm-data"))break;e=e.parentElement}return n},$watch:s,$dispatch(e,n,s){o(t,e,{detail:n,...s})},$persist(e,t){t=t||`_nmProp-${e}`;const n=localStorage[t];n&&(this[e]=JSON.parse(n)),s(()=>{localStorage[t]=JSON.stringify(this[e])})}},c=c=>{n(c,"[nm-data]").forEach(t=>{const s={...i(t.getAttribute("nm-data"),{},t),...r},n=Object.keys(s).reduce((e,t)=>(e[t]=new Set,e),{}),o=new Proxy(s,{get(t,s){return s in n&&e&&n[s].add(e),t[s]},set(t,s,o){t[s]=o,s in n||(n[s]=new Set);const i=e;return e=null,n[s].forEach(e=>e()),e=i,!0}});t.nmProxy=o}),n(c,"[nm-ref]").forEach(e=>{const t=a(e),n=e.getAttribute("nm-ref");t.$refs[n]=e}),n(c,"[nm-bind]").forEach(e=>{const n=a(e),r=i(e.getAttribute("nm-bind"),n,e);Object.entries(r).forEach(([n,o])=>{if(n.startsWith("on")){const[a,...s]=n.slice(2).split("."),r=s.find(e=>e.startsWith("debounce")),i=+r?.slice(8),c=n=>{const a=()=>{t=e,o(n),t=null};s.includes("prevent")&&n.preventDefault(),s.includes("stop")&&n.stopPropagation(),i?(clearTimeout(e.nmTimer),e.nmTimer=setTimeout(a,i)):a()};(s.includes("window")?window:e).addEventListener(a,c,{once:s.includes("once")})}else{t=e;const[i,a]=n.split(".");s(async()=>{const t=await o();a?i==="class"?e.classList.toggle(a,t):e[i][a]=t:e[i]=t}),t=null}}),o(e,"init",{bubbles:!1})})};document.addEventListener("DOMContentLoaded",()=>c(document.body))})()