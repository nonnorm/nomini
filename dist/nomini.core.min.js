(()=>{const s={$refs:{},$dataset(){let n={},e=t;for(;e;){if(n={...n,...e.dataset},e.hasAttribute("nm-data"))break;e=e.parentElement}return n},$watch:a};let e=null,t=null;const r=(e,t,n,s=!0)=>{e.dispatchEvent(new CustomEvent(`nm${t}`,{detail:n,bubbles:s}))},o=(e,t,n)=>{/^{.*}$/s.test(e)&&(e=e.slice(1,-1));try{return new Function("__data",`with(__data) {return {${e}}}`).call(n,t)}catch(t){return console.error("[Nomini] failed to parse obj:",e,`
`,t),{}}},n=(e,t)=>{const n=e.matches(t)?[e]:[];return[...n,...e.querySelectorAll(t)].filter(e=>!e.closest("[nm-ignore]"))},i=e=>e.closest("[nm-data]")?.nmProxy||{...s},a=t=>{e=t,e(),e=null},c=c=>{n(c,"[nm-data]").forEach(t=>{const i={...o(t.getAttribute("nm-data"),{},t),...s},n=Object.fromEntries(Object.keys(i).map(e=>[e,new Set])),a=new Proxy(i,{get(t,s){return s in n&&e&&n[s].add(e),t[s]},set(t,s,o){t[s]=o,s in n||(n[s]=new Set);const i=e;return e=null,n[s].forEach(e=>e()),e=i,!0}});t.nmProxy=a}),n(c,"[nm-ref]").forEach(e=>{const t=i(e),n=e.getAttribute("nm-ref");t.$refs[n]=e}),n(c,"nm-bind").forEach(e=>{const n=i(e),s=o(el.getAttribute(attr),n,el);Object.entries(s).forEach(([s,o])=>{if(o in n||(o=o.bind(e)),s.startsWith("on")){const[a,...n]=s.slice(2).split("."),r=n.find(e=>e.startsWith("debounce")),i=+r?.slice(8),c=s=>{const a=()=>{t=e,o(s),t=null};n.includes("prevent")&&s.preventDefault(),n.includes("stop")&&s.stopPropagation(),i?(clearTimeout(e.nmTimer),e.nmTimer=setTimeout(a,i)):a()};e.addEventListener(a,c,{once:n.includes("once")})}else t=e,a(async()=>{const t=await o(),[n,i]=s.split(".");i?n==="class"?e.classList.toggle(i,t):e[n][i]=t:e[n]=t}),t=null}),r(el,"init",{},!1)})};document.addEventListener("DOMContentLoaded",()=>c(document.body))})()