(()=>{const s=(e,t,n)=>{n={bubbles:!0,detail:{},...n},e.dispatchEvent(new CustomEvent(t,n))},r=(e,t,n)=>{/^{.*}$/s.test(e)&&(e=e.slice(1,-1));try{return new Function("__data",`with(__data) {return {${e}}}`).call(n,t)}catch(t){return console.error("[Nomini] failed to parse obj:",e,`
`,t),{}}},e=(e,t)=>{const n=e.matches(t)?[e]:[];return[...n,...e.querySelectorAll(t)].filter(e=>!e.closest("[nm-ignore]"))},a=e=>e.closest("[nm-data]")?.nmProxy||{...c},o=e=>{t=e,t(),t=null};let t=null,n=null;const c={$refs:{},_nmFetching:!1,_nmAbort:null,$get(e,t){this.$fetch(e,"GET",t)},$post(e,t){this.$fetch(e,"POST",t)},$fetch(e,t,o){const r=n;this._nmAbort&&this._nmAbort.abort(),this._nmAbort=new AbortController,this._nmFetching=!0;const i={headers:{"nm-request":!0},method:t,signal:this._nmAbort.signal};o={...this.$nmData(),...this.$dataset(),...o};const a=new URLSearchParams(o);/GET|DELETE/.test(t)?e+=(e.includes("?")?"&":"?")+a:i.body=a,fetch(e,i).then(async e=>{if(!e.ok){const t=await e.text();throw new Error(`${e.statusText}: ${t}`)}const t=new TextDecoder;for await(const n of e.body){const s=t.decode(n,{stream:!0});l(s)}}).catch(t=>s(r,"fetcherr",{detail:{err:t,url:e}})).finally(()=>this._nmFetching=!1)},$nmData(){const e=e=>e!==Object(e);return Object.entries(this).reduce((t,[n,s])=>/^[a-z]+$/i.test(n)?(typeof s=="function"&&(s=s()),(e(s)||Array.isArray(s)&&s.every(e))&&(t[n]=s),t):t,{})},$dataset(){let t={},e=n;for(;e;){if(t={...t,...e.dataset},e.hasAttribute("nm-data"))break;e=e.parentElement}return t},$watch:o,$dispatch(e,t,o){s(n,e,{detail:t,...o})},$persist(e,t){t=t||`_nmProp-${e}`;const n=localStorage[t];n&&(this[e]=JSON.parse(n)),o(()=>{localStorage[t]=JSON.stringify(this[e])})}},l=t=>{const n=document.createElement("template");n.innerHTML=t;for(const t of n.content.children){if(!t.id){console.warn("[Nomini] Fragment is missing an id: ",t);continue}const a=t.getAttribute("nm-swap")||"outer",o=document.getElementById(t.id);if(!o){console.warn("[Nomini] Swap target not found: #",t.id);continue}if(e(o,"[nm-bind]").forEach(e=>s(e,"destroy",{bubbles:!1})),d(t),a==="inner")o.replaceChildren(...t.childNodes),i(o);else if(a==="outer")o.replaceWith(t),i(t);else if(/(before|after|prepend|append)/.test(a)){const e=[...t.childNodes];o[a](...e),e.forEach(e=>e.nodeType===1&&i(e))}else console.error("[Nomini] Invalid swap strategy: ",a)}},d=t=>{const n=["style","class","height","width"],s=e(t,"[id]");s.forEach(e=>{const t=document.getElementById(e.id);if(t&&t.tagName===e.tagName){const o=e.cloneNode(),s=t=>n.forEach(n=>{const s=t.getAttribute(n);s?e.setAttribute(n,s):e.removeAttribute(n)});s(t),requestAnimationFrame(()=>s(o))}})},i=i=>{e(i,"[nm-use]").forEach(e=>{const t=e.getAttribute("nm-use"),n=document.getElementById(t);if(n){const t=n.content.cloneNode(!0),s=t.querySelector("slot:not([name])");s&&s.replaceWith(...e.childNodes),e.replaceChildren(t)}else console.error("[Nomini] No template with id: #",t)}),e(i,"[nm-data]").forEach(e=>{const s={...r(e.getAttribute("nm-data"),{},e),...c},n={},o=new Proxy(s,{get(e,s){return t&&(n[s]||=new Set).add(t),e[s]},set(e,s,o){e[s]=o;const i=n[s];if(i){const e=t;t=null,i.forEach(e=>e()),t=e}return!0}});e.nmProxy=o}),e(i,"[nm-ref]").forEach(e=>{const t=a(e),n=e.getAttribute("nm-ref");t.$refs[n]=e}),e(i,"[nm-form]").forEach(t=>{const n=a(t);e(t,"[name]").forEach(e=>{const t=e.type,s=()=>{let s;t==="checkbox"?s=e.checked:t==="radio"&&e.checked?s=e.value:t==="file"?s=e.files:/number|range/.test(t)?s=+e.value:s=e.value,n[e.name]=s};s(),e.addEventListener("input",s),e.addEventListener("change",s)}),e(t,"button, input[type='submit']").forEach(e=>{o(()=>e.disabled=n._nmFetching)})}),e(i,"[nm-bind]").forEach(e=>{const t=a(e),i=r(e.getAttribute("nm-bind"),t,e);Object.entries(i).forEach(([t,s])=>{if(t.startsWith("on")){const[a,...o]=t.slice(2).split("."),r=o.find(e=>e.startsWith("debounce")),i=+r?.slice(8),c=t=>{const a=()=>{n=e,s(t),n=null};if(o.includes("prevent")&&t.preventDefault(),o.includes("stop")&&t.stopPropagation(),i){clearTimeout(e.nmTimer),e.nmTimer=setTimeout(a,i);return}a()};(o.includes("window")?window:e).addEventListener(a,c,{once:o.includes("once")})}else{n=e;const[i,a]=t.split(".");o(async()=>{const t=await s();a?i==="class"?e.classList.toggle(a,t):e[i][a]=t:e[i]=t}),n=null}}),s(e,"init",{bubbles:!1})})};document.addEventListener("DOMContentLoaded",()=>i(document.body))})()